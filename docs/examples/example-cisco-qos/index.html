<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=toni-moreno.github.io/snmpcollector.org/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=toni-moreno.github.io/snmpcollector.org/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=/toni-moreno.github.io/snmpcollector.org/main.bb749f5013a81b9f8f0ae300ebeac84d81825e31211e2ee03ac9ca077a4afae7bd9c497d50a4c5e3a39f59434c1f6590080497647d4a5f647f1e76f4ef0298e8.css integrity="sha512-u3SfUBOoG5+PCuMA6+rITYGCXjEhHi7gOsnKB3pK+ue9nEl9UKTF46OfWUNMH2WQCASXZH1KX2R/Hnb07wKY6A==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>- snmpcollector</title><meta name=description content><link rel=canonical href=toni-moreno.github.io/snmpcollector.org/docs/examples/example-cisco-qos/><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Example: Retrieve metrics from Cisco QoS - CISCO-CLASS-BASED-QOS-MIB This example will show up how to retrieve QoS metrics from a Cisco Device, based on one of the most complex MIB - CISCO-CLASS-BASED-QOS-MIB Only valid on 0.9
 Table of contents  0 Prerequisites : What and from we are going to collect our data?  0.1 SNMP Device model 0.2 Select metrics to collect data  0.2.1 Available object tables 0."><meta name=twitter:site content="@"><meta name=twitter:creator content="@"><meta property="og:title" content><meta property="og:description" content="Example: Retrieve metrics from Cisco QoS - CISCO-CLASS-BASED-QOS-MIB This example will show up how to retrieve QoS metrics from a Cisco Device, based on one of the most complex MIB - CISCO-CLASS-BASED-QOS-MIB Only valid on 0.9
 Table of contents  0 Prerequisites : What and from we are going to collect our data?  0.1 SNMP Device model 0.2 Select metrics to collect data  0.2.1 Available object tables 0."><meta property="og:type" content="article"><meta property="og:url" content="toni-moreno.github.io/snmpcollector.org/docs/examples/example-cisco-qos/"><meta property="og:site_name" content="snmpcollector"><meta property="article:publisher" content="https://www.facebook.com/"><meta property="article:author" content="https://www.facebook.com/"><meta property="og:locale" content><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"toni-moreno.github.io\/snmpcollector.org"},{"@type":"ListItem","position":3,"name":"Docs","item":"toni-moreno.github.io\/snmpcollector.org\/docs\/"},{"@type":"ListItem","position":4,"name":"Examples","item":"toni-moreno.github.io\/snmpcollector.org\/docs\/examples\/"},{"@type":"ListItem","position":5,"name":"Example Cisco Qos","item":"toni-moreno.github.io\/snmpcollector.org\/docs\/examples\/example-cisco-qos\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=toni-moreno.github.io/snmpcollector.org/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=toni-moreno.github.io/snmpcollector.org/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=toni-moreno.github.io/snmpcollector.org/favicon-16x16.png><link rel=manifest href=toni-moreno.github.io/snmpcollector.org/site.webmanifest></head><body class="docs single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org>snmpcollector</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/toni-moreno/snmpcollector><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class="nav-item active"><a class=nav-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/prologue/introduction/>Docs</a></li><li class=nav-item><a class=nav-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/prologue/introduction/>Download</a></li><li class=nav-item><a class=nav-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/prologue/introduction/>Community</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Prologue</h3><ul class=list-unstyled><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/prologue/introduction/>Introduction</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/prologue/quick-start/>Quick Start</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/prologue/commands/>Commands</a></li></ul><h3>Components</h3><ul class=list-unstyled><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/components/variable-catalog/>Variable Catalog</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/components/influx-servers/>InfluxDB Servers</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/components/oid-conditions/>OID Conditions</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/components/snmp-metrics/>SNMP Metrics</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/components/measurements/>Measurements</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/components/measurement-groups/>Measurement Groups</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/components/measurement-filters/>Measurement Filters</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/components/custom-filters/>Custom filters</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/components/snmp-devices/>SNMP Devices</a></li></ul><h3>Runtime</h3><ul class=list-unstyled><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/runtime/runtime/>Runtime</a></li></ul><h3>Data Management</h3><h3>Troubleshooting</h3><h3>Examples</h3><h3>Public Templates DB</h3><h3>Contributions</h3><h3>Changelog</h3><h3>help</h3><ul class=list-unstyled><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/help/how-to-update/>How to Update</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/help/troubleshooting/>Troubleshooting</a></li><li><a class=docs-link href=toni-moreno.github.io/snmpcollector.org/toni-moreno.github.io/snmpcollector.org/docs/help/faq/>FAQ</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#table-of-contents>Table of contents</a></li><li><a href=#0-prerequisites--what-and-from-we-are-going-to-collect-our-data>0. Prerequisites : What and from we are going to collect our data?</a><ul><li><a href=#01-snmp-device-model>0.1 SNMP Device model</a></li><li><a href=#02-select-metrics-to-collect-data>0.2 Select metrics to collect data</a></li><li><a href=#03-measurements>0.3 Measurements</a></li></ul></li></ul><ul><li><a href=#11-configuring-metrics>1.1 Configuring metrics</a></li><li><a href=#12-configuring-measurements>1.2 Configuring measurements</a><ul><li><a href=#121-overview>1.2.1 Overview</a></li><li><a href=#122-index-0--service-policy-index-tag-cbqosifindex>1.2.2 Index 0 | Service Policy Index Tag: cbQosIfIndex</a></li><li><a href=#123-index-1--service-policy-index-tag-cbqospolicydirection>1.2.3 Index 1 | Service Policy Index Tag: cbQosPolicyDirection</a></li><li><a href=#124-index-2--classmap-tag-cbqoscmname>1.2.4 Index 2 | ClassMap Tag: cbQosCMName</a></li><li><a href=#125-index-3--policyname-tag-cbqospolicymapname>1.2.5 Index 3 | PolicyName Tag: cbQosPolicyMapName</a></li><li><a href=#126-index-4--classmap-tag-cbqoscminfo>1.2.6 Index 4 | ClassMap Tag: cbQosCMInfo</a></li><li><a href=#127-result>1.2.7 Result</a></li></ul></li><li><a href=#13-configuring-filters>1.3 Configuring filters</a><ul><li><a href=#131-oid-condition---filter-classmap>1.3.1 OID Condition - Filter classmap</a></li><li><a href=#132-measurementfilter---filter-classmap>1.3.2 MeasurementFilter - Filter classmap</a></li></ul></li><li><a href=#14-configuring-measurement-group>1.4 Configuring Measurement Group</a></li><li><a href=#15-configuring-device>1.5 Configuring Device</a></li><li><a href=#16-reload-configuration>1.6 Reload configuration</a></li><li><a href=#17-check-your-results>1.7 Check your results!</a></li></ul><ul><li><a href=#21-configuring-metrics>2.1 Configuring metrics</a></li><li><a href=#12-configuring-measurements-1>1.2 Configuring measurements</a><ul><li><a href=#121-overview-1>1.2.1 Overview</a></li><li><a href=#222-index-0--service-policy-index-tag-cbqosifindex>2.2.2 Index 0 | Service Policy Index Tag: cbQosIfIndex</a></li><li><a href=#223-index-1--service-policy-index-tag-cbqospolicydirection>2.2.3 Index 1 | Service Policy Index Tag: cbQosPolicyDirection</a></li><li><a href=#224-index-2--classmap-tag-cbqoscmname>2.2.4 Index 2 | ClassMap Tag: cbQosCMName</a></li><li><a href=#224-index-3--policymap-tag-policymapname>2.2.4 Index 3 | PolicyMap Tag: policyMapName</a></li><li><a href=#224-result>2.2.4 Result</a></li></ul></li><li><a href=#23-configuring-filters>2.3 Configuring filters</a><ul><li><a href=#231-oid-condition---filter-ts>2.3.1 OID Condition - Filter TS</a></li><li><a href=#232-measurementfilter---filter-classmap>2.3.2 MeasurementFilter - Filter classmap</a></li></ul></li><li><a href=#24-configuring-measurement-group>2.4 Configuring Measurement Group</a></li><li><a href=#25-configuring-device>2.5 Configuring Device</a></li><li><a href=#26-reload-configuration>2.6 Reload configuration</a></li><li><a href=#27-check-your-results>2.7 Check your results!</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1></h1><p class=lead></p><h1 id=example-retrieve-metrics-from-cisco-qos---cisco-class-based-qos-mib>Example: Retrieve metrics from Cisco QoS - CISCO-CLASS-BASED-QOS-MIB</h1><p>This example will show up how to retrieve QoS metrics from a Cisco Device, based on one of the most complex MIB - <code>CISCO-CLASS-BASED-QOS-MIB</code>
<strong>Only valid on 0.9</strong></p><hr><h2 id=table-of-contents>Table of contents<a href=#table-of-contents class=anchor aria-hidden=true>#</a></h2><ul><li>0 Prerequisites : What and from we are going to collect our data?<ul><li>0.1 SNMP Device model</li><li>0.2 Select metrics to collect data<ul><li>0.2.1 Available object tables</li><li>0.2.2 Objects identifiers</li><li>0.2.3 Tags - Indexes definition</li></ul></li><li>0.3 Measurements</li></ul></li><li>1 CMStats<ul><li>1.1 Configuring metrics</li><li>1.2 Configuring measurements<ul><li>1.2.1 Overview</li><li>1.2.2 Index 0 | Service Policy Index Tag: cbQosIfIndex</li><li>1.2.3 Index 1 | Service Policy Index Tag: cbQosPolicyDirection</li><li>1.2.4 Index 2 | ClassMap Tag: cbQosCMName</li><li>1.2.5 Index 3 | PolicyName Tag: cbQosPolicyMapName</li><li>1.2.6 Index 4 | ClassMap Tag: cbQosCMInfo</li><li>1.2.7 Result</li></ul></li><li>1.3 Configuring filters<ul><li>1.3.1 OID Condition - Filter classmap</li><li>1.3.2 MeasurementFilter - Filter classmap</li></ul></li><li>1.4 Configuring Measurement Group</li><li>1.5 Configuring Device</li><li>1.6 Reload configuration</li><li>1.7 Check your results!</li></ul></li><li>2 TSStats<ul><li>2.1 Configuring metrics</li><li>1.2 Configuring measurements<ul><li>1.2.1 Overview</li><li>2.2.2 Index 0 | Service Policy Index Tag: cbQosIfIndex</li><li>2.2.3 Index 1 | Service Policy Index Tag: cbQosPolicyDirection</li><li>2.2.4 Index 2 | ClassMap Tag: cbQosCMName</li><li>2.2.4 Index 3 | PolicyMap Tag: policyMapName</li><li>2.2.4 Result</li></ul></li><li>2.3 Configuring filters<ul><li>2.3.1 OID Condition - Filter TS</li><li>2.3.2 MeasurementFilter - Filter classmap</li></ul></li><li>2.4 Configuring Measurement Group</li><li>2.5 Configuring Device</li><li>2.6 Reload configuration</li><li>2.7 Check your results!</li></ul></li></ul><hr><h2 id=0-prerequisites--what-and-from-we-are-going-to-collect-our-data>0. Prerequisites : What and from we are going to collect our data?<a href=#0-prerequisites--what-and-from-we-are-going-to-collect-our-data class=anchor aria-hidden=true>#</a></h2><h3 id=01-snmp-device-model>0.1 SNMP Device model<a href=#01-snmp-device-model class=anchor aria-hidden=true>#</a></h3><p>In order to select the correct metrics for our device, we must check first what model it is.
If you don&rsquo;t know the model, you can pre-add the device on SNMP Device Component and do a test connection. To do that:</p><ul><li>Click on <code>SNMP Device</code> menu item</li><li>A table with configured devices will show up. Press &ldquo;New&rdquo; button or edit an existing one to access to the configuration form.</li><li>Fill the device with the basic connection information</li><li>If everything is OK, you will be able to do a &ldquo;Test Connection&rdquo;. This button will show up a console with System information of the Device.</li></ul><h3 id=02-select-metrics-to-collect-data>0.2 Select metrics to collect data<a href=#02-select-metrics-to-collect-data class=anchor aria-hidden=true>#</a></h3><p>To define the metrics to retrieve data from we need first to analyze how CISCO-CLASS-BASED-QOS-MIB works
I will use the example exposed on: https://blog.pierky.com/cisco-class-based-qos-snmp-mib-and-statistics-monitor-for-nms/ as it will help to underestand a real case</p><h4 id=021-available-object-tables>0.2.1 Available object tables<a href=#021-available-object-tables class=anchor aria-hidden=true>#</a></h4><p>In <code>CISCO-CLASS-BASED-QOS-MIB</code> the tables are defined by each kind of object that is available to be configured on QoS.
Each object has a <strong>CFG Table</strong> that shows config information and <strong>StatsTable</strong> with the available metrics to retrieve data from.</p><p>On this example, we will work over the following objects and tables:</p><table><thead><tr><th>Object</th><th>CFG Table</th><th>Stats Table</th></tr></thead><tbody><tr><td>Policy Map</td><td><code>cbQosPolicyMapCfg - 1.3.6.1.4.1.9.9.166.1.6.1.1</code></td><td>&ndash;</td></tr><tr><td>ClassMap</td><td><code>cbQosClassMapCfg - 1.3.6.1.4.1.9.9.166.1.7.1.1</code></td><td><code>cbQosCMStatsTable - 1.3.6.1.4.1.9.9.166.1.15.1.1</code></td></tr><tr><td>MatchStmt</td><td><code>cbQosMatchStmtCfg - 1.3.6.1.4.1.9.9.166.1.8.1.1</code></td><td><code>cbQosMatchStmtStats - 1.3.6.1.4.1.9.9.166.1.16.1.1</code></td></tr><tr><td>TS</td><td><code>cbQosTSCfg - 1.3.6.1.4.1.9.9.166.1.13.1.1</code></td><td><code>cbQosTSStats - 1.3.6.1.4.1.9.9.166.1.19</code></td></tr></tbody></table><p align=center>ℹ️ QoS objets table</p><p>As PolicyMap doesn&rsquo;t have stats on itself, we will cover in this example how to retrieve data from:</p><ul><li>ClassMap Object</li><li>TS Object</li></ul><h4 id=022-objects-identifiers>0.2.2 Objects identifiers<a href=#022-objects-identifiers class=anchor aria-hidden=true>#</a></h4><p>Once we have decided objects to retrieve data from, we need to check how to identify each metrics and what tags do we need</p><p>The tree hierarchy of QoS follows as:</p><pre><code>Interface 
| - Direction
| - PolicyMap
    |- ClassMap
      |- MatchStmt
      |- TS
</code></pre><p>So, the deeper object is, more tags we will need to retrieve in order to be able to identify it:</p><table><thead><tr><th>Object</th><th>Tags needed</th></tr></thead><tbody><tr><td>PolicyMap</td><td><em>Interface, Direction, PolicyMap</em></td></tr><tr><td>ClassMap</td><td><em>Interface, Direction, PolicyMap, ClassMap</em></td></tr><tr><td>MatchStmt</td><td><em>Interface, Direction, PolicyMap, ClassMap, MatchStmt</em></td></tr><tr><td>TS</td><td><em>Interface, Direction, PolicyMap, ClassMap, MatchStmt</em></td></tr></tbody></table><p align=center>ℹ️ QoS objets table-tags relation</p><h4 id=023-tags---indexes-definition>0.2.3 Tags - Indexes definition<a href=#023-tags---indexes-definition class=anchor aria-hidden=true>#</a></h4><p>Each object defined on XXXXStatsTable and XXXXCfg tables have a double index.
In order to reference them to the document, lets identify and name them:</p><table><thead><tr><th>Base</th><th>Index</th><th>Name</th></tr></thead><tbody><tr><td><strong>XXX</strong>.YYY</td><td>XXX</td><td>Service Policy Index</td></tr><tr><td>XXX.<strong>YYY</strong></td><td>YYY</td><td>Object Index</td></tr></tbody></table><p align=center>ℹ️ Index definition</p><h3 id=03-measurements>0.3 Measurements<a href=#03-measurements class=anchor aria-hidden=true>#</a></h3><p>As we have seen, each object needs specific tags to identify those metrics and, based on that they are double indexed, we will create a single measurement to retrieve each object stats</p><h1 id=1-cmstats>1. CMStats</h1><p>The first set of data that we want to retrieve are the CMStats</p><h2 id=11-configuring-metrics>1.1 Configuring metrics<a href=#11-configuring-metrics class=anchor aria-hidden=true>#</a></h2><p>Available metrics are defined on <code>cbQosCMStatsTable - 1.3.6.1.4.1.9.9.166.1.15.1.1</code>.
In our example we will configure the following metrics:</p><table><thead><tr><th>ID</th><th>Field Name</th><th>IsTag</th><th>DataSrcType</th><th>GetRate</th><th>Base OID/Extradata</th><th>Scale</th><th>Shift</th></tr></thead><tbody><tr><td>cisco_cbQosCMPrePolicyPkt64</td><td>cbQosCMPrePolicyPkt64</td><td>false</td><td>COUNTER64</td><td>false</td><td>.1.3.6.1.4.1.9.9.166.1.15.1.1.3</td><td>0</td><td>0</td></tr><tr><td>cisco_cbQosCMPrePolicyByte64</td><td>cbQosCMPrePolicyByte64</td><td>false</td><td>COUNTER64</td><td>false</td><td>.1.3.6.1.4.1.9.9.166.1.15.1.1.6</td><td>0</td><td>0</td></tr><tr><td>cisco_cbQosCMPrePolicyBitRate</td><td>cbQosCMPrePolicyBitRate</td><td>false</td><td>Gauge32</td><td>false</td><td>.1.3.6.1.4.1.9.9.166.1.15.1.1.7</td><td>0</td><td>0</td></tr></tbody></table><p align=center>ℹ️ QoS CMStats metrics configuration</p><p>As we have said, each metric will have a double index: <code>[Service Policy Index].[Object Index]</code></p><h2 id=12-configuring-measurements>1.2 Configuring measurements<a href=#12-configuring-measurements class=anchor aria-hidden=true>#</a></h2><p>Let&rsquo;s start to define the measurement</p><h3 id=121-overview>1.2.1 Overview<a href=#121-overview class=anchor aria-hidden=true>#</a></h3><p>As we have defined, the CMStats needs the following tags to identify each metric:</p><ul><li>Interface</li><li>Direction</li><li>PolicyMap Name</li><li>ClassMap Name</li><li>[Extra] ClassMap Info</li></ul><p>The main problem here is that each tag is being retrieved with <strong>different indexes and different indexes dimension</strong>, so in order to correlate those tags and indexes we need to define a <strong>Multi Index Measurement</strong></p><p>To do that, go to <code>Influx Measurements</code> section and click on <code>+New</code></p><p>Fill the <code>ID</code> and <code>Name</code> fields with:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>ID</td><td>cisco_qos_cbQosCMStats</td><td>Unique SNMPCollector internal identifier of measurement</td></tr><tr><td>Name</td><td>cbQosCMStats</td><td>Measurement name that will be used on InfluxDB</td></tr></tbody></table><p align=center>ℹ️ Measurement config section</p><p>On the <code>GetMode</code> field select:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>GetMode</td><td>(snmp Table) Multiple indexes</td><td>&ndash;</td></tr></tbody></table><p align=center>ℹ️ Measurement get mode</p><h3 id=122-index-0--service-policy-index-tag-cbqosifindex>1.2.2 Index 0 | Service Policy Index Tag: cbQosIfIndex<a href=#122-index-0--service-policy-index-tag-cbqosifindex class=anchor aria-hidden=true>#</a></h3><p>The first that we need to retrieve are interface related tags, name and direction.
According to documentation, we need to poll the following OIDs to retrieve those tags:</p><table><thead><tr><th>Name</th><th>OID</th><th>Index</th></tr></thead><tbody><tr><td>cbQosIfIndex</td><td>1.3.6.1.4.1.9.9.166.1.1.1.1.4</td><td>Service Policy</td></tr></tbody></table><p align=center>ℹ️ Service policy index</p><p>A simple walk on this OID gives as value the <code>ifIndex</code></p><pre><code class=language-bash>&gt; cbQosIfIndex: 1.3.6.1.4.1.9.9.166.1.1.1.1.4

1.3.6.1.4.1.9.9.166.1.1.1.1.4[.1043] = INTEGER: 1
1.3.6.1.4.1.9.9.166.1.1.1.1.4[.1099] = INTEGER: 1
</code></pre><p>Note that the <code>[.1043]</code> and <code>[.1099]</code> will be used on the following indexes definition as <code>Service Policy Index</code></p><p>The value of <code>1</code> is the ifIndex index, so, if we retrieve data from ifName using that index we will be able to retrieve the related ifName of the interface:</p><pre><code class=language-bash>&gt; ifName: 1.3.6.1.2.1.31.1.1.1.1

1.3.6.1.2.1.31.1.1.1.1[.1] = &quot;Te1/0/3&quot;
</code></pre><p>As we have an indirect tag, we will create an index with <strong>"(snmp Table) Indexed with indirect Tag"</strong></p><p>![mi-indexed_it]</p><p>And will fill with the following fields:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index Label</td><td>cbQosIfIndex</td><td>Unique SNMPCollector internal identifier of measurement</td></tr><tr><td>Index Description</td><td>Index to retrieve interface name from cbQosIfIndex</td><td>&ndash;</td></tr><tr><td>Index Base OID</td><td>.1.3.6.1.4.1.9.9.166.1.1.1.1.4</td><td>Base OID is the cbQosIfIndex which gives us the value of the ifMIB index</td></tr><tr><td>Index Tag OID</td><td>.1.3.6.1.2.1.31.1.1.1.1</td><td>ifName TagOID that will match with cbQosIfIndex result</td></tr><tr><td>Index Tag</td><td>ifName</td><td>We will use directly the name of the field that is being retrieved, but you can set whatever you want as your Tag Key</td></tr><tr><td>Index Tag Format</td><td>&ndash;</td><td>We don&rsquo;t need to format the ifName tag, but you are free to set up whatever you want!</td></tr><tr><td>Index Dependency</td><td>&ndash;</td><td>We don&rsquo;t need a dependency as it will be the first OID to retrieve tag from</td></tr></tbody></table><p align=center>ℹ️ Index 0 - cbQosIfIndex</p><p><img src=https://github.com/toni-moreno/snmpcollector/blob//gh-pages/images/webUI/Examples/QoS/cbqosifindex_meas.jpg alt=cbqosifindex_meas title="example of index dfefinition of cbqosifIndex"></p><p>The final output map of pairs [index]:[tag] will be:</p><pre><code class=language-bash>&gt; Index: IDX{0} | cbQosIfIndex

[.1043] = &quot;Te1/0/3&quot; || ifName
[.1099] = &quot;Te1/0/3&quot; || ifName
</code></pre><h3 id=123-index-1--service-policy-index-tag-cbqospolicydirection>1.2.3 Index 1 | Service Policy Index Tag: cbQosPolicyDirection<a href=#123-index-1--service-policy-index-tag-cbqospolicydirection class=anchor aria-hidden=true>#</a></h3><p>Once we have the inferface name, we can get the direction of the applied policy on each interface, in order to retrieve that we can query the following OID that gives us the direction.
Note that the index keeps only in 1 dimension and it is related with the <code>Service Policy Index</code></p><table><thead><tr><th>Name</th><th>OID</th><th>Index</th></tr></thead><tbody><tr><td>cbQosPolicyDirection</td><td>.1.3.6.1.4.1.9.9.166.1.1.1.1.3</td><td><strong>Service Policy Index</strong></td></tr></tbody></table><p>A simple walk on this OID gives the direction of the policy applied on an interface</p><pre><code class=language-bash>&gt; cbQosPolicyDirection:  

.1.3.6.1.4.1.9.9.166.1.1.1.1.3[.1043] = INTEGER: output(2)
.1.3.6.1.4.1.9.9.166.1.1.1.1.3[.1099] = INTEGER: input(1)
</code></pre><p>In this case, we don&rsquo;t need to do an indirection, as it is giving directly the value of the tag, so we can use a <strong>"(snmp Table) Index with direct TAG"</strong></p><p>![mi-indexed]</p><p>As we can see, the indexes are also [.1043] and [.1099] - <code>Service Policy Index</code> and they are shared with the <code>IDX{0}</code>, the <code>cbQosIfIndex</code> index</p><p>We will fill the index with the following field/values:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index Label</td><td>cbQosPolicyDirection</td><td>Unique SNMPCollector internal identifier of measurement</td></tr><tr><td>Index Description</td><td>Index to retrieve interface name from cbQosPolicyDirection</td><td>&ndash;</td></tr><tr><td>Index Base OID</td><td>.1.3.6.1.4.1.9.9.166.1.1.1.1.3</td><td>Base OID is the cbQosPolicyDirection which gives us the value of the direction</td></tr><tr><td>Index Tag</td><td>policyDirection</td><td>We will use directly the name of the field that is being retrieved, but you can set whatever you want as your Tag Key</td></tr><tr><td>Index Tag Format</td><td>&ndash;</td><td>We don&rsquo;t need to format the policyDirection tag, but you are free to set up whatever you want!</td></tr><tr><td>Index Dependency</td><td>IDX{0};DOT[0:0];SKIP</td><td>(*)</td></tr></tbody></table><p align=center>ℹ️ Index 1 - cbQosPolicyDirection</p><p>(*) Dependency:</p><p>We set up a dependency with the IDX{0}, as they shares the same Index in order to heridate ifIndex Tags. We will use a SKIP strategy</p><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/cbqospolicydirection_meas.jpg alt=cbqospolicydirection_meas title="example of definition of cbqospolicydirection"></p><p>At this point, we will have that the <code>IDX{1}</code> will be:</p><pre><code>&gt; Index: IDX{0} | cbQosIfIndex

[.1043] = &quot;Te1/0/3&quot; || ifName
[.1099] = &quot;Te1/0/3&quot; || ifName

&gt; Index: IDX{1} | cbQosPolicyDirection | IDX{0};DOT[0:0];SKIP

[.1043] = &quot;Te1/0/3|2&quot; || ifName | policyDirection
[.1099] = &quot;Te1/0/3|1&quot; || ifName | policyDirection
</code></pre><p>We just finished to map the first index <code>Service Policy Index</code> and feed it with <code>ifName</code> and <code>policyDirection</code> tags</p><h3 id=124-index-2--classmap-tag-cbqoscmname>1.2.4 Index 2 | ClassMap Tag: cbQosCMName<a href=#124-index-2--classmap-tag-cbqoscmname class=anchor aria-hidden=true>#</a></h3><p>On this point, we are going to retrieve the ClassMap name. Despite of the above indexes, the table to retrieve the class map name has now a <strong>double index</strong>: <code>Service Policy</code>.<code>Object Index</code></p><p>To retrieve values from CFG tables, the MIB provides an OID to get the index reference to the object, which it has to be retrieved from <code>cbQosConfigIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.2</code></p><p>A walk over the cbQosConfigIndex:</p><pre><code>&gt; cbQosConfigIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.2

.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1043] = Gauge32: 1035
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1045] = Gauge32: 1029
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1047] = Gauge32: 1033
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1049] = Gauge32: 1037
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1051] = Gauge32: 1025
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1053] = Gauge32: 1027
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1085] = Gauge32: 1079
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1099] = Gauge32: 1063
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1101] = Gauge32: 1057
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1103] = Gauge32: 1061
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1105] = Gauge32: 1065
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1107] = Gauge32: 1025
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1109] = Gauge32: 1027
</code></pre><p>The name of the classmaps comes from the table: <code>cbQosCMName - .1.3.6.1.4.1.9.9.166.1.7.1.1.1</code></p><p>A walk over the <code>cbQosCMName</code> table:</p><pre><code>&gt; cbQosCMName - .1.3.6.1.4.1.9.9.166.1.7.1.1.1

.1.3.6.1.4.1.9.9.166.1.7.1.1.1[.1025] = STRING: class-default
.1.3.6.1.4.1.9.9.166.1.7.1.1.1[.1029] = STRING: ICMP
.1.3.6.1.4.1.9.9.166.1.7.1.1.1[.1057] = STRING: NonLocal
</code></pre><p>Note that the index is directly the one recieved from cbQosConfigIndex:</p><pre><code>&gt; cbQosConfigIndex (filtered) - .1.3.6.1.4.1.9.9.166.1.5.1.1.2

...
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1045] = Gauge32: 1029
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1051] = Gauge32: 1025
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1101] = Gauge32: 1057
...
</code></pre><p>As we have said, the first index references to the <code>Service Policy Index</code> and the second index refers directly to the <code>Object Index</code>.</p><p>As we have an indirect tag, we will create an index with <strong>"(snmp Table) Indexed with indirect Tag"</strong></p><p>![mi-indexed_it]</p><p>We will fill with the following field/values:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index Label</td><td>cbQosCMName</td><td>Unique SNMPCollector internal identifier of measurement</td></tr><tr><td>Index Description</td><td>Index to retrieve CMName</td><td>&ndash;</td></tr><tr><td>Index Base OID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.2</td><td>Base OID is the <code>cbQosConfigIndex</code> which gives us the value of the config related with cbQosCMName table</td></tr><tr><td>Index Tag OID</td><td>.1.3.6.1.4.1.9.9.166.1.7.1.1.1</td><td><code>cbQosCMName</code> TagOID that will match with <code>cbQosConfigIndex</code> result</td></tr><tr><td>Index Tag</td><td>cmName</td><td>We will use directly the name of the field that is being retrieved, but you can set whatever you want as your Tag Key</td></tr><tr><td>Index Tag Format</td><td>&ndash;</td><td>We don&rsquo;t need to format the policyDirection tag, but you are free to set up whatever you want!</td></tr><tr><td>Index Dependency</td><td>IDX{1};DOT[0:0];SKIP</td><td>(*)</td></tr></tbody></table><p align=center>ℹ️ Index 2 - cbQosCMName</p><p>(*) Dependency</p><p>The dependency in ths case is based on <code>IDX{1}</code> - cbQosPolicyDirection that already have ifName tag.
In this case, the metrics have indexes with dimension 2, so we need to change the check condition based only on the first index, the <code>Service Policy Index</code>, using the statement <code>DOT[0:0]</code></p><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/cbqoscmname_meas.jpg alt=cbqoscmname_meas title="example of definition of cbQosCMName index"></p><p>At this point, we will have that the <code>IDX{1}</code> will be:</p><pre><code>
&gt; IDX{1}:

[.1043] = &quot;Te1/0/3|2&quot; || ifName | policyDirection
[.1099] = &quot;Te1/0/3|1&quot; || ifName | policyDirection

&gt; Index: IDX{2} | cbQosCMName | IDX{1};DOT[0:0];SKIP

&gt;&gt; DOT[0:0] = [.1043] / [.1099]

[.1043][.1045] = &quot;Te1/0/3|2|ICMP&quot;           || ifName | policyDirection | cmName
[.1043][.1051] = &quot;Te1/0/3|2|class-default&quot;  || ifName | policyDirection | cmName
[.1099][.1101] = &quot;Te1/0/3|1|NonLocal&quot;       || ifName | policyDirection | cmName

</code></pre><p>We just started to map the both index <code>Service Policy</code>.<code>Object Index</code></p><h3 id=125-index-3--policyname-tag-cbqospolicymapname>1.2.5 Index 3 | PolicyName Tag: cbQosPolicyMapName<a href=#125-index-3--policyname-tag-cbqospolicymapname class=anchor aria-hidden=true>#</a></h3><p>As each class is attached to a policyName, we need to identify the classmap with the name of the policy.
The name of the policy can be retrieved from the following OID:</p><table><thead><tr><th>Name</th><th>OID</th><th>Index</th></tr></thead><tbody><tr><td>cbQosPolicyMapName</td><td>1.3.6.1.4.1.9.9.166.1.6.1.1.1</td><td><strong>Service Policy Index</strong>.<strong>Object Index</strong></td></tr></tbody></table><p>A simple walk over the <code>cbQosPolicyMapName</code>:</p><pre><code>&gt; cbQosPolicyMapName - 1.3.6.1.4.1.9.9.166.1.6.1.1.1

1.3.6.1.4.1.9.9.166.1.6.1.1.1[.1035] = STRING: LAN_Out
1.3.6.1.4.1.9.9.166.1.6.1.1.1[.1063] = STRING: CPP
</code></pre><p>The problem here, is that the pair index of <code>Service Policy Index.Object Index</code> is <strong>different from the classmap object type</strong>. In order to retrieve this informaton and keep the classmap index, we must query the following OID - <code>cbQosParentObjectsIndex</code> - <code>1.3.6.1.4.1.9.9.166.1.5.1.1.4</code> that gives us the relation between objects on QoS:</p><p>A simple walk over the <code>cbQosParentObjectsIndex</code>:</p><pre><code>&gt; cbQosParentObjectsIndex - 1.3.6.1.4.1.9.9.166.1.5.1.1.4

1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1043] = Gauge32: 0
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1045] = Gauge32: 1043
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1047] = Gauge32: 1045
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1049] = Gauge32: 1045
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1051] = Gauge32: 1043
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1053] = Gauge32: 1051
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1085] = Gauge32: 1051
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1099] = Gauge32: 0
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1101] = Gauge32: 1099
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1103] = Gauge32: 1101
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1105] = Gauge32: 1101
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1107] = Gauge32: 1099
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1109] = Gauge32: 1107

</code></pre><p>The object relates the child with the parent, so filtering the, the pair of OID from classmap we will obtain the index of the policy attached to:</p><pre><code>...
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1045] = Gauge32: 1043
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1051] = Gauge32: 1043
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1101] = Gauge32: 1099
...
</code></pre><p>The index values referes to the <code>Object Index</code> from <code>PolicyMap</code>, so the new indexes that we want to build in order to query the PolicyName, must be:</p><pre><code>[.1043][.1043] - PolicyMap
[.1099][.1099] - PolicyMap
</code></pre><p>With the information above we need to define a new measurement, but in this case, we need to do at least 2 indirects and, in the middle modify the check condition with another indexes, so we define the measurement as <strong>"(snmp Table) Indexed with multiple indirect TAG"</strong></p><p>![mi-indexed_mit]</p><p>We fill the index with the following field/values:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index Label</td><td>cbQosPolicyMapName</td><td>Unique SNMPCollector internal identifier of measurement</td></tr><tr><td>Index Description</td><td>Index to retrieve cbQosPolicyMapName</td><td>&ndash;</td></tr><tr><td>Index Base OID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.4</td><td>Base OID is the <code>cbQosParentObjectsIndex</code> which gives us the value of the config related with <code>Object Index</code> from <code>PolicyMap</code></td></tr><tr><td>Index Tag</td><td>policyMapName</td><td>We will use directly the name of the field that is being retrieved, but you can set whatever you want as your Tag Key</td></tr><tr><td>Index Tag Format</td><td>&ndash;</td><td>We don&rsquo;t need to format the policyDirection tag, but you are free to set up whatever you want!</td></tr><tr><td>Multi Tag OID</td><td>(*)</td><td>Multiple indirects to obtain the PolicyName and keep it on ClassMap pair of <code>Service Policy Index</code>.<code>Object Index</code></td></tr><tr><td>Index Dependency</td><td>IDX{2};DOT[0:1];SKIP</td><td>(**)</td></tr></tbody></table><p align=center>ℹ️ Index 3 - cbQosPolicyMapName</p><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/cbqospolicymapname_meas.jpg alt=cbqospolicymapname_meas title="example of definition of cbQosPolicyMapName"></p><p><strong>(*) Multi Tag OID</strong></p><p>We will define 2 TagOID:</p><p>TagOID 0:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index TagOID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.2</td><td>Index TagOID to retrieve the <code>Object Index</code> from <code>PolicyMap</code></td></tr><tr><td>IndexFormat</td><td><code>${IDX1|DOT[0:0]|STRING}.$VAL1${IDX1|DOT[0:0]|STRING}.$VAL1</code></td><td></td></tr></tbody></table><p>This IndexFormat will modify the check condition and will create the desired index in order keep iterating over indirect tables. Following with the example:</p><p>The generated index is just the <code>Service Policy Index</code>.<code>Object Index</code> from <code>PolicyMap</code>, so we can use this to retrieve any parameter from <code>PolicyMapCfg</code> table, just using the same indirect as we defined on CM, but using different indexes</p><p>TagOID 1:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index TagOID</td><td>.1.3.6.1.4.1.9.9.166.1.6.1.1.1</td><td>Index TagOID to retrieve the PolicyMap Name</td></tr><tr><td>IndexFormat</td><td>&ndash;</td><td></td></tr></tbody></table><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/cbqospolicymapname_meas_index.jpg alt=cbqospolicymapname_meas_index title="example of definition of cbQosPolicyMapName multi TagOID"></p><p><strong>(**) Dependency</strong></p><p>In this case, we need to retrieve both indexes from the IDX{2}, the complete CMIndex <code>Service Policy Index</code>.<code>Object Index</code></p><p>The logic is:</p><ul><li>From BaseOID, we will retrieve the desired parent index:</li></ul><pre><code>&gt; cbQosParentObjectsIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.4
...
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1045] = Gauge32: 1043
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1051] = Gauge32: 1043
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1101] = Gauge32: 1099
...
</code></pre><ul><li>On the first TagOID, it will try to retrieve the ObjectIndex, but with a modified IDX:</li></ul><pre><code>&gt; ${IDX1|DOT[0:0]|STRING}.$VAL1
[.1043][.1043]
[.1043][.1043]
[.1099][.1099]


&gt; cbQosConfigIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.2

...
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1043] = Gauge32: 1035
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1109] = Gauge32: 1027
...

</code></pre><ul><li>And finally, the last TagOID will retrieve the policyNameMap</li></ul><pre><code>&gt; cbQosPolicyMapName - 1.3.6.1.4.1.9.9.166.1.6.1.1.1

1.3.6.1.4.1.9.9.166.1.6.1.1.1[.1035] = STRING: LAN_Out
1.3.6.1.4.1.9.9.166.1.6.1.1.1[.1063] = STRING: CPP
</code></pre><p>The final index will be the Base with the retrieved tags from policy name:</p><pre><code>[.1043][.1045] = &quot;LAN_Out&quot;
[.1043][.1051] = &quot;LAN_Out&quot;
[.1099][.1101] = &quot;CPP&quot;
</code></pre><p>At this point, the IDX{3}, will be, with heridated tags from IDX{2}:</p><pre><code>&gt; Index: IDX{2}

[.1043][.1045] = &quot;Te1/0/3|2|ICMP&quot;           || ifName | policyDirection | cmName
[.1043][.1051] = &quot;Te1/0/3|2|class-default&quot;  || ifName | policyDirection | cmName
[.1099][.1101] = &quot;Te1/0/3|1|NonLocal&quot;       || ifName | policyDirection | cmName

&gt; Index: IDX{3} | cbQosPolicyMapName | IDX{2};DOT[0:1];SKIP

[.1043][.1045] = &quot;Te1/0/3|2|ICMP|LAN_Out&quot;           || ifName | policyDirection | cmName | policyMapName
[.1043][.1051] = &quot;Te1/0/3|2|class-default|LAN_Out&quot;  || ifName | policyDirection | cmName | policyMapName
[.1099][.1101] = &quot;Te1/0/3|1|NonLocal|CPP&quot;       || ifName | policyDirection | cmName | policyMapName

</code></pre><h3 id=126-index-4--classmap-tag-cbqoscminfo>1.2.6 Index 4 | ClassMap Tag: cbQosCMInfo<a href=#126-index-4--classmap-tag-cbqoscminfo class=anchor aria-hidden=true>#</a></h3><p>Once we have mapped the CMName and its related PolicyMap Name, we can also retrieve the extra info: <code>cbQosCMInfo - .1.3.6.1.4.1.9.9.166.1.7.1.1.3</code>, already present in table of <code>cbQosClassMapCfg - 1.3.6.1.4.1.9.9.166.1.7.1.1</code>, so the way to configure the measurement is exactly the same as <code>cbQosCMName</code> with the same config index.
A simple walk over <code>cbQosCMInfo</code>:</p><pre><code>&gt; cbQosCMInfo - .1.3.6.1.4.1.9.9.166.1.7.1.1.3

.1.3.6.1.4.1.9.9.166.1.7.1.1.3[.1025] = INTEGER: matchAny(3)
.1.3.6.1.4.1.9.9.166.1.7.1.1.3[.1029] = INTEGER: matchAll(2)
.1.3.6.1.4.1.9.9.166.1.7.1.1.3[.1057] = INTEGER: matchAny(3)
</code></pre><p>As we have an indirect tag, we will create an index with &ldquo;(snmp Table) Indexed with indirect TAG&rdquo;</p><p>![mi-indexed_it]</p><p>We fill with the index with following field/values:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index Label</td><td>cbQosCMInfo</td><td>Unique SNMPCollector internal identifier of measurement</td></tr><tr><td>Index Description</td><td>Index to retrieve cbQosCMInfo</td><td>&ndash;</td></tr><tr><td>Index Base OID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.2</td><td>Base OID is the <code>cbQosConfigIndex</code> which gives us the value of the config related with <code>cbQosCMInfo</code> table</td></tr><tr><td>Index Tag OID</td><td>.1.3.6.1.4.1.9.9.166.1.7.1.1.3</td><td><code>cbQosCMInfo</code> TagOID that will match with <code>cbQosConfigIndex</code> result</td></tr><tr><td>Index Tag</td><td>cmInfo</td><td>We will use directly the name of the field that is being retrieved, but you can set whatever you want as your Tag Key</td></tr><tr><td>Index Tag Format</td><td>&ndash;</td><td>We don&rsquo;t need to format the policyDirection tag, but you are free to set up whatever you want!</td></tr><tr><td>Index Dependency</td><td>IDX{3};DOT[0:1];SKIP</td><td>(*)</td></tr></tbody></table><p align=center>ℹ️ Index 4 - cbQosCMInfo</p><p><strong>(*) Dependency</strong></p><p>In this case, as the matching index is the full index and it will just heridate the IDX{3} tags</p><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/cbqoscminfo_meas.jpg alt=cbqoscminfo_meas title="example of definition of cbQosCMInfo"></p><p>At this point, the IDX{4}, will be, with heridated tags from IDX{3}:</p><pre><code>&gt; Index: IDX{3}

[.1043][.1045] = &quot;Te1/0/3|2|ICMP|LAN_Out&quot;           || ifName | policyDirection | cmName | policyMapName
[.1043][.1051] = &quot;Te1/0/3|2|class-default|LAN_Out&quot;  || ifName | policyDirection | cmName | policyMapName
[.1099][.1101] = &quot;Te1/0/3|1|NonLocal|CPP&quot;       || ifName | policyDirection | cmName | policyMapName


&gt; Index: IDX{4} | cbQosCMInfo | IDX{3};DOT[0:1];SKIP

...
[.1043][.1045] = &quot;Te1/0/3|2|ICMP|LAN_Out|&quot;           || ifName | policyDirection | cmName | policyMapName | cbQosCMInfo|3
[.1043][.1051] = &quot;Te1/0/3|2|class-default|LAN_Out|2&quot;  || ifName | policyDirection | cmName | policyMapName | cbQosCMInfo
[.1099][.1101] = &quot;Te1/0/3|1|NonLocal|CPP|3&quot;       || ifName | policyDirection | cmName | policyMapName |cbQosCMInfo
...
</code></pre><h3 id=127-result>1.2.7 Result<a href=#127-result class=anchor aria-hidden=true>#</a></h3><p>Finally, we setup the result of our multiindex.</p><p>As we have heredated all tags until the last index, we only need to setup up the result as:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Result</td><td>IDX{4}</td><td>Result of the multiindex</td></tr></tbody></table><p>And the final pair of <code>[index]:[TagValues]</code> will be:</p><pre><code>...
[.1043][.1045] = &quot;Te1/0/3|2|ICMP|LAN_Out|2&quot;
[.1043][.1051] = &quot;Te1/0/3|2|class-default|LAN_Out|2&quot;
[.1099][.1101] = &quot;Te1/0/3|1|NonLocal|CPP|3&quot;
...
</code></pre><h2 id=13-configuring-filters>1.3 Configuring filters<a href=#13-configuring-filters class=anchor aria-hidden=true>#</a></h2><p>As the base OID of our CMStats is directly the <code>Service Policy Index</code>.<code>Object Index</code> based on <code>cbQosConfigIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.2</code> it will generate an entry for each object index, but not only the related with CM, also the PolicyMap, MatchStmt and all available object in all stats table.</p><p>In order to retrieve only the desired one based on what we are retrieving, we will define a <code>Measurement Filter</code></p><h3 id=131-oid-condition---filter-classmap>1.3.1 OID Condition - Filter classmap<a href=#131-oid-condition---filter-classmap class=anchor aria-hidden=true>#</a></h3><p>We want to filter only classmap objects, so we need to define a new condition over the OID <code>cbQosObjectsType - .1.3.6.1.4.1.9.9.166.1.5.1.1.3</code></p><p>A simple walk over this OID:</p><pre><code>&gt; cbQosObjectsType - .1.3.6.1.4.1.9.9.166.1.5.1.1.3

.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1043] = INTEGER: policymap(1)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1045] = INTEGER: classmap(2)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1047] = INTEGER: trafficShaping(6)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1049] = INTEGER: queueing(4)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1051] = INTEGER: classmap(2)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1053] = INTEGER: trafficShaping(6)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1085] = INTEGER: queueing(4)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1099] = INTEGER: policymap(1)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1101] = INTEGER: classmap(2)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1103] = INTEGER: trafficShaping(6)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1105] = INTEGER: police(7)
....

</code></pre><p>And filtered by desired one: <code>classmap(2)</code>:</p><pre><code>...
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1045] = INTEGER: classmap(2)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1051] = INTEGER: classmap(2)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1101] = INTEGER: classmap(2)
...
</code></pre><p>Go to menu and click over <code>OID Condition</code> section
Create a <code>+ New</code> OID Condition and fill it with:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>ID</td><td>cbQosObjectsType_classmap</td><td>The unique internal ID to identify the OID Condition</td></tr><tr><td>Is Multiple</td><td>false</td><td>It allows to create a OID condition based on already defined ones</td></tr><tr><td>OID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.3</td><td>The OID to filter based on object type</td></tr><tr><td>CondType</td><td>(neq) numeric equal</td><td>As the output is an integer, we will select number equal as condition type</td></tr><tr><td>CondValue</td><td>2</td><td>Filter only the class objects</td></tr></tbody></table><p align=center>ℹ️ OIDCondition to filter classmap objects</p><h3 id=132-measurementfilter---filter-classmap>1.3.2 MeasurementFilter - Filter classmap<a href=#132-measurementfilter---filter-classmap class=anchor aria-hidden=true>#</a></h3><p>Now, we want to create a new measurement filter with already created OID condition</p><p>Go to menu and click over <code>Measurement Filters</code> section
Create a <code>+ New</code> OID Condition and fill it with:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>ID</td><td>cisco_qos_cbQosCMStats_classmap</td><td>The unique internal ID to identify the Measurement Filter</td></tr><tr><td>Measurements</td><td>cisco_qos_cbQosCMStats..cbQosPolicyMapName</td><td>We will select the internal index of policyMapName</td></tr><tr><td>Filter type</td><td>OID Condition</td><td>Filter type</td></tr><tr><td>Oid Condition</td><td>cbQosObjectsType_classmap</td><td>The already created OID Condition only to filter classmap objects</td></tr></tbody></table><p align=center>ℹ️ Measurement filter to apply OIDCondition on CMStats</p><h2 id=14-configuring-measurement-group>1.4 Configuring Measurement Group<a href=#14-configuring-measurement-group class=anchor aria-hidden=true>#</a></h2><p>Go to menu and click over <code>Measurement Filters</code> section
Create a <code>+ New</code> Measurement Group and fill it with:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>ID</td><td>Cisco_QOS</td><td>The unique internal ID to identify the Measurement Group</td></tr><tr><td>Measurements</td><td>cisco_qos_cbQosCMStats</td><td>Measurement from cisco_qos_cbQosCMStats</td></tr></tbody></table><p align=center>ℹ️ Cisco_QOS measurement group with CMStats</p><h2 id=15-configuring-device>1.5 Configuring Device<a href=#15-configuring-device class=anchor aria-hidden=true>#</a></h2><p>Attach your new measurement group and filters to the existing Device with QoS enabled</p><h2 id=16-reload-configuration>1.6 Reload configuration<a href=#16-reload-configuration class=anchor aria-hidden=true>#</a></h2><p>In order to reload configuration you must click on the menu item <code>Reload Config</code>. Once the SNMP Collector will receive the signal and it will try to reload all configuration. During that process you won&rsquo;t be able to navigate until the process is finished.</p><h2 id=17-check-your-results>1.7 Check your results!<a href=#17-check-your-results class=anchor aria-hidden=true>#</a></h2><p>See what are you collecting from the Runtime component!</p><ul><li>Click on <code>Runtime</code> menu item</li><li>Find your device and check if its actived and connected. If not, check your connection data!</li><li>Click on the eye icon and see what are you collecting!!!</li></ul><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/runtime_qoscm.jpg alt=runtime_qoscm title="Example of QoS CMStats"></p><h1 id=2-tsstats>2. TSStats</h1><p>The first set of data that we want to retrieve are the TSStats</p><h2 id=21-configuring-metrics>2.1 Configuring metrics<a href=#21-configuring-metrics class=anchor aria-hidden=true>#</a></h2><p>Available metrics are defined on <code>cbQosCMStatsTable - 1.3.6.1.4.1.9.9.166.1.15.1.1</code>.
In our example we will configure the following metrics:</p><table><thead><tr><th>ID</th><th>Field Name</th><th>IsTag</th><th>DataSrcType</th><th>GetRate</th><th>Base OID/Extradata</th><th>Scale</th><th>Shift</th></tr></thead><tbody><tr><td>cisco_cbQosTSStatsDelayedByte64</td><td>cbQosTSStatsDelayedByte64</td><td>false</td><td>COUNTER64</td><td>false</td><td>.1.3.6.1.4.1.9.9.166.1.19.1.1.3</td><td>0</td><td>0</td></tr><tr><td>cisco_cbQosTSStatsDelayedPkt64</td><td>cbQosCMPrePolicyByte64</td><td>false</td><td>COUNTER64</td><td>false</td><td>.1.3.6.1.4.1.9.9.166.1.19.1.1.6</td><td>0</td><td>0</td></tr><tr><td>cisco_cbQosTSStatsDropByte64</td><td>cbQosCMPrePolicyBitRate</td><td>false</td><td>COUNTER64</td><td>false</td><td>.1.3.6.1.4.1.9.9.166.1.19.1.1.9</td><td>0</td><td>0</td></tr></tbody></table><p>As we have said, each metric will have a double index: <code>[Service Policy Index].[Object Index]</code></p><h2 id=12-configuring-measurements-1>1.2 Configuring measurements<a href=#12-configuring-measurements-1 class=anchor aria-hidden=true>#</a></h2><p>Let&rsquo;s start to define the measurement</p><h3 id=121-overview-1>1.2.1 Overview<a href=#121-overview-1 class=anchor aria-hidden=true>#</a></h3><p>As we have defined, the TSStats needs the following tags to identify each metric:</p><ul><li>Interface</li><li>Direction</li><li>PolicyMap Name</li><li>ClassMap Name</li></ul><blockquote><p>Note that as a TS is related with ClassMap, we will retrieve also it</p></blockquote><h3 id=222-index-0--service-policy-index-tag-cbqosifindex>2.2.2 Index 0 | Service Policy Index Tag: cbQosIfIndex<a href=#222-index-0--service-policy-index-tag-cbqosifindex class=anchor aria-hidden=true>#</a></h3><p>It is the same configuration as CMStats</p><p>The final output map of pairs [index]:[tag] will be:</p><pre><code>&gt; Index: IDX{0} | cbQosIfIndex

[.1043] = &quot;Te1/0/3&quot; || ifName
[.1099] = &quot;Te1/0/3&quot; || ifName
</code></pre><h3 id=223-index-1--service-policy-index-tag-cbqospolicydirection>2.2.3 Index 1 | Service Policy Index Tag: cbQosPolicyDirection<a href=#223-index-1--service-policy-index-tag-cbqospolicydirection class=anchor aria-hidden=true>#</a></h3><p>It is the same configuration as CMStats</p><p>At this point, we will have that the <code>IDX{1}</code> will be:</p><pre><code>&gt; Index: IDX{0} | cbQosIfIndex

[.1043] = &quot;Te1/0/3&quot; || ifName
[.1099] = &quot;Te1/0/3&quot; || ifName

&gt; Index: IDX{1} | cbQosPolicyDirection | IDX{0};DOT[0:0];SKIP

[.1043] = &quot;Te1/0/3|2&quot; || ifName | policyDirection
[.1099] = &quot;Te1/0/3|1&quot; || ifName | policyDirection
</code></pre><h3 id=224-index-2--classmap-tag-cbqoscmname>2.2.4 Index 2 | ClassMap Tag: cbQosCMName<a href=#224-index-2--classmap-tag-cbqoscmname class=anchor aria-hidden=true>#</a></h3><p>As we have done on CMStats with PolicyMap name, as ClassMap is another object type, we need to iterate over relations OID - <code>> cbQosParentObjectsIndex - 1.3.6.1.4.1.9.9.166.1.5.1.1.4</code> in order to identify the related ClassMap</p><p>In this case, filtered by the matchstmt objects:</p><pre><code>&gt; cbQosParentObjectsIndex - 1.3.6.1.4.1.9.9.166.1.5.1.1.4

...
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1043] = Gauge32: 0
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1045] = Gauge32: 1043 # classmap
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1047] = Gauge32: 1045 # ts
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1051] = Gauge32: 1043 # classmap
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1053] = Gauge32: 1051 # ts
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1099] = Gauge32: 0 # policymap
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1101] = Gauge32: 1099 # classmap
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1103] = Gauge32: 1101 # ts
...
</code></pre><p>So, as we have done on CMStats, we need to make a multiple indrection in order to retrieve the classmap name, so, we will create an as <strong>"(snmp Table) Indexed with multiple indirect TAG"</strong></p><p>![mi-indexed_mit]</p><p>We fill the index with the following field/values:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index Label</td><td>cbQosCMName</td><td>Unique SNMPCollector internal identifier of measurement</td></tr><tr><td>Index Description</td><td>Index to retrieve cbQosCMName</td><td>&ndash;</td></tr><tr><td>Index Base OID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.4</td><td>Base OID is the <code>cbQosParentObjectsIndex</code> which gives us the value of the config related with <code>Object Index</code> from <code>ClassMap</code></td></tr><tr><td>Index Tag</td><td>cmName</td><td>We will use directly the name of the field that is being retrieved, but you can set whatever you want as your Tag Key</td></tr><tr><td>Index Tag Format</td><td>&ndash;</td><td>We don&rsquo;t need to format the policyDirection tag, but you are free to set up whatever you want!</td></tr><tr><td>Multi Tag OID</td><td>(*)</td><td>Multiple indirects to obtain the ClassMapName and keep it on ClassMap pair of <code>Service Policy Index</code>.<code>Object Index</code></td></tr><tr><td>Index Dependency</td><td>IDX{1};DOT[0:0];SKIP</td><td>(**)</td></tr></tbody></table><p align=center>ℹ️ Index 2 - cbQosCMName</p><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/cbqoscmname_ts_meas.jpg alt=cbqoscmname_ts_meas title="Example of CMName from TSStats"></p><p><strong>(*) Multi Tag OID</strong></p><p>We will define 2 TagOID:</p><p><em><strong>TagOID 0</strong></em>:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index TagOID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.2</td><td>Index TagOID to retrieve the <code>Object Index</code> from <code>ClassMap</code></td></tr><tr><td>IndexFormat</td><td><code>${IDX1|DOT[0:0]|STRING}.$VAL1${IDX1|DOT[0:0]|STRING}.$VAL1</code></td><td></td></tr></tbody></table><p>This IndexFormat will modify the check condition and will create the desired index in order keep iterating over indirect tables. Following with the example:</p><p>The generated index is just the <code>Service Policy Index</code>.<code>Object Index</code> from <code>ClassMap</code>, so we can use this to retrieve any parameter from <code>ClassMapCFG</code> table, but using different indexes</p><p><em><strong>TagOID 1</strong></em>:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index TagOID</td><td>.1.3.6.1.4.1.9.9.166.1.7.1.1.1</td><td>Index TagOID to retrieve the ClassMap Name</td></tr><tr><td>IndexFormat</td><td>&ndash;</td><td></td></tr></tbody></table><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/cbqoscmname_meas_index.jpg alt=cbqoscmname_meas_index title="example of definition of cbqosCMName multi TagOID"></p><p><strong>(**) Dependency</strong></p><p>In this case, we will retrieve the to retrieve only the <code>Service Policy Index</code> from IDX{1}</p><p>The logic is:</p><ul><li>From BaseOID, we will retrieve the desired parent index:</li></ul><pre><code>&gt; cbQosParentObjectsIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.4
...
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1047] = Gauge32: 1045
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1053] = Gauge32: 1051
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1103] = Gauge32: 1101
...
</code></pre><ul><li>On the first TagOID, it will try to retrieve the ObjectIndex, but with a modified IDX:</li></ul><pre><code>&gt; ${IDX1|DOT[0:0]|STRING}.$VAL1
[.1043][.1045]
[.1043][.1051]
[.1099][.1101]


&gt; cbQosConfigIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.2

...
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1045] = Gauge32: 1029
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1051] = Gauge32: 1025
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1101] = Gauge32: 1057
...
</code></pre><ul><li>And finally, the last TagOID will retrieve the CMName</li></ul><pre><code>&gt; cbQosCMName - .1.3.6.1.4.1.9.9.166.1.7.1.1.1

.1.3.6.1.4.1.9.9.166.1.7.1.1.1[.1025] = STRING: class-default
.1.3.6.1.4.1.9.9.166.1.7.1.1.1[.1029] = STRING: ICMP
.1.3.6.1.4.1.9.9.166.1.7.1.1.1[.1057] = STRING: NonLocal
</code></pre><p>The final index will be the Base with the retrieved tags from classmap name:</p><pre><code>[.1043][.1047] = &quot;ICMP&quot;
[.1043][.1053] = &quot;class-default&quot;
[.1099][.1103] = &quot;NonLocal&quot;
</code></pre><p>At this point, the IDX{2}, will be, with heridated tags from IDX{1}:</p><pre><code>&gt; Index IDX{1}:

[.1043] = &quot;Te1/0/3|2&quot; || ifName | policyDirection
[.1099] = &quot;Te1/0/3|1&quot; || ifName | policyDirection

&gt; Index: IDX{2} | cbQosCMName | IDX{1};DOT[0:0];SKIP

&gt;&gt; DOT[0:0] = [.1043] / [.1099]

[.1043][.1047] = &quot;Te1/0/3|2|ICMP&quot;           || ifName | policyDirection | cmName
[.1043][.1053] = &quot;Te1/0/3|2|class-default&quot;  || ifName | policyDirection | cmName
[.1099][.1103] = &quot;Te1/0/3|1|NonLocal&quot;       || ifName | policyDirection | cmName

</code></pre><h3 id=224-index-3--policymap-tag-policymapname>2.2.4 Index 3 | PolicyMap Tag: policyMapName<a href=#224-index-3--policymap-tag-policymapname class=anchor aria-hidden=true>#</a></h3><p>As we have done on the previous index, we will try to retrieve also the PolicyMap name, in this case, we need a double iteration to retrieve the PolicyMap parents from ClassMap- <code>> cbQosParentObjectsIndex - 1.3.6.1.4.1.9.9.166.1.5.1.1.4</code> in order to identify the related ClassMap</p><p>In this case, filtered by the matchstmt objects:</p><pre><code>&gt; cbQosParentObjectsIndex - 1.3.6.1.4.1.9.9.166.1.5.1.1.4

...
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1043] = Gauge32: 0
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1045] = Gauge32: 1043 # classmap
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1047] = Gauge32: 1045 # ts
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1051] = Gauge32: 1043 # classmap
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1053] = Gauge32: 1051 # ts
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1099] = Gauge32: 0 # policymap
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1101] = Gauge32: 1099 # classmap
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1103] = Gauge32: 1101 # ts
...
</code></pre><p>To do that, we will repeat the step on the Index 2, but in this case we will add a new Tag OID to go over PolicyMap objects instead of ClassMap objects</p><p>we will create an as <strong>"(snmp Table) Indexed with multiple indirect TAG"</strong></p><p>![mi-indexed_mit]</p><p>We fill the index with the following field/values:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index Label</td><td>cbQosPolicyMapName</td><td>Unique SNMPCollector internal identifier of measurement</td></tr><tr><td>Index Description</td><td>Index to retrieve cbQosPolicyMapName</td><td>&ndash;</td></tr><tr><td>Index Base OID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.4</td><td>Base OID is the <code>cbQosParentObjectsIndex</code> which gives us the value of the config related with <code>Object Index</code> from <code>PolicyMap</code></td></tr><tr><td>Index Tag</td><td>cmName</td><td>We will use directly the name of the field that is being retrieved, but you can set whatever you want as your Tag Key</td></tr><tr><td>Index Tag Format</td><td>&ndash;</td><td>We don&rsquo;t need to format the policyDirection tag, but you are free to set up whatever you want!</td></tr><tr><td>Multi Tag OID</td><td>(*)</td><td>Multiple indirects to obtain the ClassMapName and keep it on ClassMap pair of <code>Service Policy Index</code>.<code>Object Index</code></td></tr><tr><td>Index Dependency</td><td>IDX{2};DOT[0:1];SKIP</td><td>(**)</td></tr></tbody></table><p align=center>ℹ️ Index 3 - cbQosPolicyMapName</p><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/cbqospolicyname_ts_meas.jpg alt=cbqospolicyname_ts_meas title="Example of PolicyMapName from TSStats"></p><p><strong>(*) Multi Tag OID</strong></p><p>We will define 2 TagOID:</p><p><em><strong>TagOID 0</strong></em>:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index TagOID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.4</td><td>Index TagOID to retrieve the <code>Parent Object</code> from <code>ClassMap</code></td></tr><tr><td>IndexFormat</td><td><code>${IDX1|DOT[0:0]|STRING}.$VAL1${IDX1|DOT[0:0]|STRING}.$VAL1</code></td><td></td></tr></tbody></table><p>This IndexFormat will modify the check condition and will create the desired index in order keep iterating over indirect tables. Following with the example:</p><p>The generated index is just the <code>Service Policy Index</code>.<code>Object Index</code> from <code>ClassMap</code>, so we can use this to retrieve the index of <code>PolicyMap</code> related with this <code>ClassMap</code> table, but using different indexes</p><p><em><strong>TagOID 1</strong></em>:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index TagOID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.2</td><td>Index TagOID to retrieve the <code>Object Index</code> from <code>PolicyMap</code></td></tr><tr><td>IndexFormat</td><td><code>${IDX1|DOT[0:0]|STRING}.$VAL1${IDX1|DOT[0:0]|STRING}.$VAL1</code></td><td></td></tr></tbody></table><p>This IndexFormat will modify the check condition and will create the desired index in order keep iterating over indirect tables. Following with the example:</p><p>The generated index is just the <code>Service Policy Index</code>.<code>Object Index</code> from <code>ClassMap</code>, so we can use this to retrieve any parameter from <code>ClassMapCFG</code> table, but using different indexes</p><p><em><strong>TagOID 2</strong></em>:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Index TagOID</td><td>.1.3.6.1.4.1.9.9.166.1.6.1.1.1</td><td>Index TagOID to retrieve the PolicyMap Name</td></tr><tr><td>IndexFormat</td><td>&ndash;</td><td></td></tr></tbody></table><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/cbqoscmname_meas_index_ts.jpg alt=cbqoscmname_meas_index_ts title="example of definition of cbqosPolicyMap multi TagOID"></p><p><strong>(**) Dependency</strong></p><p>In this case, we need to retrieve both indexes from the IDX{2}, the complete CMIndex <code>Service Policy Index</code>.<code>Object Index</code></p><p>The logic is:</p><ul><li>From BaseOID, we will retrieve the desired parent index:</li></ul><pre><code>&gt; cbQosParentObjectsIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.4
...
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1047] = Gauge32: 1045
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1043][.1053] = Gauge32: 1051
1.3.6.1.4.1.9.9.166.1.5.1.1.4[.1099][.1103] = Gauge32: 1101
...
</code></pre><ul><li>On the first TagOID, it will try to retrieve the cbQosParentObjectsIndex, but with a modified IDX, so we will match the related ClassMap</li></ul><pre><code>&gt; ${IDX1|DOT[0:0]|STRING}.$VAL1
[.1043][.1045]
[.1043][.1051]
[.1099][.1101]


&gt; cbQosParentObjectsIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.4

...
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1045] = Gauge32: 1043
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1051] = Gauge32: 1043
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1101] = Gauge32: 1099
...

</code></pre><ul><li>On the second TagOID, it will try to retrieve the ObjectIndex, but with a modified IDX:</li></ul><pre><code>&gt; ${IDX1|DOT[0:0]|STRING}.$VAL1
[.1043][.1043]
[.1043][.1043]
[.1099][.1099]


&gt; cbQosConfigIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.2

...
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1043][.1043] = Gauge32: 1035
.1.3.6.1.4.1.9.9.166.1.5.1.1.2[.1099][.1099] = Gauge32: 1027
...

</code></pre><ul><li>And finally, the last TagOID will retrieve the policyNameMap</li></ul><pre><code>&gt; cbQosPolicyMapName - 1.3.6.1.4.1.9.9.166.1.6.1.1.1

1.3.6.1.4.1.9.9.166.1.6.1.1.1[.1035] = STRING: LAN_Out
1.3.6.1.4.1.9.9.166.1.6.1.1.1[.1063] = STRING: CPP
</code></pre><p>The final index will be the Base with the retrieved tags from policy name:</p><pre><code>[.1043][.1047] = &quot;LAN_Out&quot;
[.1043][.1053] = &quot;LAN_Out&quot;
[.1099][.1103] = &quot;CPP&quot;
</code></pre><p>At this point, the IDX{3}, will be, with heridated tags from IDX{2}:</p><pre><code>&gt; Index: IDX{2}

[.1043][.1047] = &quot;Te1/0/3|2|ICMP&quot;           || ifName | policyDirection | cmName
[.1043][.1053] = &quot;Te1/0/3|2|class-default&quot;  || ifName | policyDirection | cmName
[.1099][.1103] = &quot;Te1/0/3|1|NonLocal&quot;       || ifName | policyDirection | cmName

&gt; Index: IDX{3} | cbQosPolicyMapName | IDX{2};DOT[0:1];SKIP

[.1043][.1047] = &quot;Te1/0/3|2|ICMP|LAN_Out&quot;           || ifName | policyDirection | cmName | policyMapName
[.1043][.1053] = &quot;Te1/0/3|2|class-default|LAN_Out&quot;  || ifName | policyDirection | cmName | policyMapName
[.1099][.1103] = &quot;Te1/0/3|1|NonLocal|CPP&quot;       || ifName | policyDirection | cmName | policyMapName

</code></pre><h3 id=224-result>2.2.4 Result<a href=#224-result class=anchor aria-hidden=true>#</a></h3><p>Finally, we setup the result of our multiindex.</p><p>As we have heredated all tags until the last index, we only need to setup up the result as:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>Result</td><td>IDX{3}</td><td>Result of the multiindex</td></tr></tbody></table><p>And the final pair of <code>[index]:[TagValues]</code> will be:</p><pre><code>...
[.1043][.1047] = &quot;Te1/0/3|2|ICMP|LAN_Out&quot;
[.1043][.1053] = &quot;Te1/0/3|2|class-default|LAN_Out&quot;
[.1099][.1103] = &quot;Te1/0/3|1|NonLocal|CPP&quot;
...
</code></pre><h2 id=23-configuring-filters>2.3 Configuring filters<a href=#23-configuring-filters class=anchor aria-hidden=true>#</a></h2><p>As the base OID of our CMStats is directly the <code>Service Policy Index</code>.<code>Object Index</code> based on <code>cbQosConfigIndex - .1.3.6.1.4.1.9.9.166.1.5.1.1.2</code> it will generate an entry for each object index, but not only the related with CM, also the PolicyMap, MatchStmt and all available object in all stats table.</p><p>In order to retrieve only the desired one based on what we are retrieving, we will define a <code>Measurement Filter</code></p><h3 id=231-oid-condition---filter-ts>2.3.1 OID Condition - Filter TS<a href=#231-oid-condition---filter-ts class=anchor aria-hidden=true>#</a></h3><p>We want to filter only classmap objects, so we need to define a new condition over the OID <code>cbQosObjectsType - .1.3.6.1.4.1.9.9.166.1.5.1.1.3</code></p><p>A simple walk over this OID:</p><pre><code>&gt; cbQosObjectsType - .1.3.6.1.4.1.9.9.166.1.5.1.1.3

.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1043] = INTEGER: policymap(1)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1045] = INTEGER: classmap(2)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1047] = INTEGER: trafficShaping(6)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1049] = INTEGER: queueing(4)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1051] = INTEGER: classmap(2)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1053] = INTEGER: trafficShaping(6)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1085] = INTEGER: queueing(4)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1099] = INTEGER: policymap(1)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1101] = INTEGER: classmap(2)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1103] = INTEGER: trafficShaping(6)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1105] = INTEGER: police(7)
....

</code></pre><p>And filtered by desired one: <code>trafficShaping(6)</code>:</p><pre><code>...
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1047] = INTEGER: trafficShaping(6)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1043][.1053] = INTEGER: trafficShaping(6)
.1.3.6.1.4.1.9.9.166.1.5.1.1.3[.1099][.1103] = INTEGER: trafficShaping(6)
...
</code></pre><p>Go to menu and click over <code>OID Condition</code> section
Create a <code>+ New</code> OID Condition and fill it with:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>ID</td><td>cbQosObjectsType_trafficShaping</td><td>The unique internal ID to identify the OID Condition</td></tr><tr><td>Is Multiple</td><td>false</td><td>It allows to create a OID condition based on already defined ones</td></tr><tr><td>OID</td><td>.1.3.6.1.4.1.9.9.166.1.5.1.1.3</td><td>The OID to filter based on object type</td></tr><tr><td>CondType</td><td>(neq) numeric equal</td><td>As the output is an integer, we will select number equal as condition type</td></tr><tr><td>CondValue</td><td>6</td><td>Filter only the class objects</td></tr></tbody></table><p align=center>ℹ️ OID Condition to filter trafficShaping</p><h3 id=232-measurementfilter---filter-classmap>2.3.2 MeasurementFilter - Filter classmap<a href=#232-measurementfilter---filter-classmap class=anchor aria-hidden=true>#</a></h3><p>Now, we want to create a new measurement filter with already created OID condition</p><p>Go to menu and click over <code>Measurement Filters</code> section
Create a <code>+ New</code> OID Condition and fill it with:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>ID</td><td>cisco_qos_cbQosTSStats_trafficShaping</td><td>The unique internal ID to identify the Measurement Filter</td></tr><tr><td>Measurements</td><td>cisco_qos_cbQosTSStats..cbQosPolicyMapName</td><td>We will select the internal index of policyMapName</td></tr><tr><td>Filter type</td><td>OID Condition</td><td>Filter type</td></tr><tr><td>Oid Condition</td><td>cbQosObjectsType_trafficShaping</td><td>The already created OID Condition only to filter classmap objects</td></tr></tbody></table><p align=center>ℹ️ Measurement filter to apply OIDCondition on TSStats</p><h2 id=24-configuring-measurement-group>2.4 Configuring Measurement Group<a href=#24-configuring-measurement-group class=anchor aria-hidden=true>#</a></h2><p>Go to menu and click over <code>Measurement Filters</code> section
Create a <code>+ New</code> Measurement Group and fill it with:</p><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>ID</td><td>Cisco_QOS</td><td>The unique internal ID to identify the Measurement Group</td></tr><tr><td>Measurements</td><td>cisco_qos_cbQosTSStats</td><td>Measurement from cisco_qos_cbQosTSStats</td></tr></tbody></table><p align=center>ℹ️ Cisco_QOS measurement group with TSStats</p><h2 id=25-configuring-device>2.5 Configuring Device<a href=#25-configuring-device class=anchor aria-hidden=true>#</a></h2><p>Attach your new measurement group and filters to the existing Device with QoS enabled</p><h2 id=26-reload-configuration>2.6 Reload configuration<a href=#26-reload-configuration class=anchor aria-hidden=true>#</a></h2><p>In order to reload configuration you must click on the menu item <code>Reload Config</code>. Once the SNMP Collector will receive the signal and it will try to reload all configuration. During that process you won&rsquo;t be able to navigate until the process is finished.</p><h2 id=27-check-your-results>2.7 Check your results!<a href=#27-check-your-results class=anchor aria-hidden=true>#</a></h2><p>See what are you collecting from the Runtime component!</p><ul><li>Click on <code>Runtime</code> menu item</li><li>Find your device and check if its actived and connected. If not, check your connection data!</li><li>Click on the eye icon and see what are you collecting!!!</li></ul><p><img src=https://github.com/toni-moreno/snmpcollector/blob/gh-pages/images/webUI/Examples/QoS/runtime_qosts.jpg alt=runtime_qosts title="Example of QoS TSStats"></p><div class="docs-navigation d-flex justify-content-between"><a href=toni-moreno.github.io/snmpcollector.org/docs/data-management/import/><div class="card my-1"><div class="card-body py-2">&larr;</div></div></a><a class=ms-auto href=toni-moreno.github.io/snmpcollector.org/docs/examples/example-configuring-cisco-catalyst-switch/><div class="card my-1"><div class="card-body py-2">&rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://gohugo.io/>Hugo</a>, and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/toni-moreno.github.io/snmpcollector.org/js/highlight.min.5c9528a6a1c07a12ee5032cb94e4c7bef72740593cde4b26300995d7e94526b35ea2b5b6981f7ac317032690ad6c5318f3ff17d6117f383c0346b3cd7a7771a2.js integrity="sha512-XJUopqHAehLuUDLLlOTHvvcnQFk83ksmMAmV1+lFJrNeorW2mB96wxcDJpCtbFMY8/8X1hF/ODwDRrPNendxog==" crossorigin=anonymous defer></script><script src=/toni-moreno.github.io/snmpcollector.org/main.min.398009e84eec0d0056c796393dd59c0fc1256540b3c6ebcd70d26840a1b2691113affd7d2d9d9e37aa22e3877e8a95b26b19dcd28341036f26390ee91ded7d25.js integrity="sha512-OYAJ6E7sDQBWx5Y5PdWcD8ElZUCzxuvNcNJoQKGyaRETr/19LZ2eN6oi44d+ipWyaxnc0oNBA28mOQ7pHe19JQ==" crossorigin=anonymous defer></script><script src=/toni-moreno.github.io/snmpcollector.org/index.min.37ececb1bdf358eb15c15d491ed044f194c680c9df72770cb05fdfd7c0dd24803b0c6854c5f63c3a380e9b4c979e93789223241c62167bdc3aa98739d16a1291.js integrity="sha512-N+zssb3zWOsVwV1JHtBE8ZTGgMnfcncMsF/f18DdJIA7DGhUxfY8OjgOm0yXnpN4kiMkHGIWe9w6qYc50WoSkQ==" crossorigin=anonymous defer></script></body></html>